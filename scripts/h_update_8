#!/bin/bash
THISUSER=$(whoami)
    if [ $THISUSER != 'root' ]
        then
            echo 'You must use sudo to run this script, sorry!'
           exit 1
    fi

exec 1> >(tee -a /var/log/openflixrupdate/h_update_8.log) 2>&1
TODAY=$(date)
echo "-----------------------------------------------------"
echo "Date:          $TODAY"
echo "-----------------------------------------------------"

## OpenFLIXR Update version 1.2.6
# system updates
pip install lxml
#pip install html5lib

# update updateof
cp /opt/update/updates/openflixr/updateof /opt/openflixr/updateof
chmod +x /opt/openflixr/updateof

# landing page updates
cp /opt/update/updates/landingpage/index.html /usr/share/nginx/html/openflixr/index.html
cp /opt/update/updates/landingpage/check.png /usr/share/nginx/html/openflixr/assets/img/check.png

## let system know update has been installed
touch /opt/update/doneupdate/h_update_8

## update version
sed -i 's/1.*/1.2.6 Dionysus/' /opt/openflixr/version
sed -i 's/Media Server 1.*/Media Server 1.2.6<\/span>/' /usr/share/nginx/html/openflixr/index.html
crudini --set /usr/share/nginx/html/setup/config.ini custom custom1 1.2.6

# reboot system just to be sure
reboot now
